requireLogin();(function(){
  const params=new URLSearchParams(location.search); const inicio=params.get('inicio'); const fim=params.get('fim'); const periodo=document.getElementById('periodo'); const resumo=document.getElementById('resumo'); const tbody=document.getElementById('tabela').querySelector('tbody');
  const store=loadStore(); const todas=Object.keys(store).sort(); const filtradas=todas.filter(d=>{ if(inicio && d<inicio) return false; if(fim && d>fim) return false; return true; }); periodo.textContent = `Período: ${inicio?inicio:'(início não definido)'} até ${fim?fim:'(fim não definido)'}`;
  let totPrev=0, totExec=0; filtradas.forEach(d=>{ const s=store[d]; const res=s.resumo || {previstos:(s.exercicios||[]).length, executados:(s.exercicios||[]).filter(e=>e.done).length}; const pct=res.previstos?Math.round(100*res.executados/res.previstos):0; totPrev+=res.previstos; totExec+=res.executados; const tr=document.createElement('tr'); tr.innerHTML=`<td>${formatBR(d)}</td><td>${res.previstos}</td><td>${res.executados}</td><td>${pct}%</td><td>${s.meta?.esforco??''}</td><td>${(s.meta?.obs||'').replace(/</g,'&lt;')}</td>`; tbody.appendChild(tr); }); const pctTot=totPrev?Math.round(100*totExec/totPrev):0; resumo.innerHTML = `<strong>Previstos:</strong> ${totPrev} · <strong>Executados:</strong> ${totExec} · <strong>Concluído:</strong> ${pctTot}%`;
})();
